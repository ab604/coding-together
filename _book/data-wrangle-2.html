<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Data wrangling II | Coding togetheR</title>
  <meta name="description" content="Materials for the Coding TogetheR workshops" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Data wrangling II | Coding togetheR" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ab604.github.io/docs/coding-together-2019/" />
  <meta property="og:image" content="https://ab604.github.io/docs/coding-together-2019/img/Carrick-bend-Guten-Verrill-modified.png" />
  <meta property="og:description" content="Materials for the Coding TogetheR workshops" />
  <meta name="github-repo" content="ab604/coding-together" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Data wrangling II | Coding togetheR" />
  <meta name="twitter:site" content="@alistair604" />
  <meta name="twitter:description" content="Materials for the Coding TogetheR workshops" />
  <meta name="twitter:image" content="https://ab604.github.io/docs/coding-together-2019/img/Carrick-bend-Guten-Verrill-modified.png" />

<meta name="author" content="Alistair Bailey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-wrangle-1.html"/>
<link rel="next" href="viz.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Coding togetheR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-and-rstudio"><i class="fa fa-check"></i>R and RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-is-coding-together-for"><i class="fa fa-check"></i>Who is coding togetheR for?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of conduct</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#coding-is-for-everyone"><i class="fa fa-check"></i><b>1.1</b> Coding is for everyone</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#a-little-background-and-philosophy"><i class="fa fa-check"></i><b>1.2</b> A little background and philosophy</a><ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#what-is-r"><i class="fa fa-check"></i><b>1.2.1</b> What is R?</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#why-learn-to-code-at-all"><i class="fa fa-check"></i><b>1.2.2</b> Why learn to code at all?</a></li>
<li class="chapter" data-level="1.2.3" data-path="getting-started.html"><a href="getting-started.html#a-little-goes-a-long-way"><i class="fa fa-check"></i><b>1.2.3</b> A little goes a long way</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="getting-started.html"><a href="getting-started.html#rstudio"><i class="fa fa-check"></i><b>1.3</b> RStudio</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-started.html"><a href="getting-started.html#what-is-real"><i class="fa fa-check"></i><b>1.3.1</b> What is real?</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-started.html"><a href="getting-started.html#file-structure"><i class="fa fa-check"></i><b>1.3.2</b> Where am I?</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-started.html"><a href="getting-started.html#install-packages"><i class="fa fa-check"></i><b>1.4</b> Installing and loading packages</a></li>
<li class="chapter" data-level="1.5" data-path="getting-started.html"><a href="getting-started.html#functions-1"><i class="fa fa-check"></i><b>1.5</b> Using functions</a></li>
<li class="chapter" data-level="1.6" data-path="getting-started.html"><a href="getting-started.html#getting-help"><i class="fa fa-check"></i><b>1.6</b> Getting help</a><ul>
<li class="chapter" data-level="1.6.1" data-path="getting-started.html"><a href="getting-started.html#using-to-access-r-function-help-pages"><i class="fa fa-check"></i><b>1.6.1</b> Using <code>?</code> to access R function help pages</a></li>
<li class="chapter" data-level="1.6.2" data-path="getting-started.html"><a href="getting-started.html#using-google-to-find-r-answers"><i class="fa fa-check"></i><b>1.6.2</b> Using Google to find R answers</a></li>
<li class="chapter" data-level="1.6.3" data-path="getting-started.html"><a href="getting-started.html#asking-questions"><i class="fa fa-check"></i><b>1.6.3</b> Asking questions</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="getting-started.html"><a href="getting-started.html#workflow"><i class="fa fa-check"></i><b>1.7</b> A project orientated workflow</a><ul>
<li class="chapter" data-level="1.7.1" data-path="getting-started.html"><a href="getting-started.html#rstudio-projects"><i class="fa fa-check"></i><b>1.7.1</b> RStudio Projects</a></li>
<li class="chapter" data-level="1.7.2" data-path="getting-started.html"><a href="getting-started.html#r-notebooks-and-r-scripts"><i class="fa fa-check"></i><b>1.7.2</b> R notebooks and R scripts</a></li>
<li class="chapter" data-level="1.7.3" data-path="getting-started.html"><a href="getting-started.html#here"><i class="fa fa-check"></i><b>1.7.3</b> Level up with the <code>here</code> package</a></li>
<li class="chapter" data-level="1.7.4" data-path="getting-started.html"><a href="getting-started.html#names"><i class="fa fa-check"></i><b>1.7.4</b> Naming things</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="getting-started.html"><a href="getting-started.html#tidy-data"><i class="fa fa-check"></i><b>1.8</b> The tidyverse and tidy data</a></li>
<li class="chapter" data-level="1.9" data-path="getting-started.html"><a href="getting-started.html#r-atoms"><i class="fa fa-check"></i><b>1.9</b> Atoms of R</a></li>
<li class="chapter" data-level="1.10" data-path="getting-started.html"><a href="getting-started.html#assignment"><i class="fa fa-check"></i><b>1.10</b> Assigning objects</a><ul>
<li class="chapter" data-level="1.10.1" data-path="getting-started.html"><a href="getting-started.html#indexing-and-subsetting"><i class="fa fa-check"></i><b>1.10.1</b> Indexing and subsetting</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="getting-started.html"><a href="getting-started.html#lists-matrices-and-arrays"><i class="fa fa-check"></i><b>1.11</b> Lists, matrices and arrays</a><ul>
<li class="chapter" data-level="1.11.1" data-path="getting-started.html"><a href="getting-started.html#matrices-and-arrays"><i class="fa fa-check"></i><b>1.11.1</b> Matrices and arrays</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="getting-started.html"><a href="getting-started.html#factors"><i class="fa fa-check"></i><b>1.12</b> Factors</a></li>
<li class="chapter" data-level="1.13" data-path="getting-started.html"><a href="getting-started.html#data-frames"><i class="fa fa-check"></i><b>1.13</b> Data frames</a><ul>
<li class="chapter" data-level="1.13.1" data-path="getting-started.html"><a href="getting-started.html#attributes"><i class="fa fa-check"></i><b>1.13.1</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="getting-started.html"><a href="getting-started.html#plotting-data"><i class="fa fa-check"></i><b>1.14</b> Plotting data</a></li>
<li class="chapter" data-level="1.15" data-path="getting-started.html"><a href="getting-started.html#exporting-data"><i class="fa fa-check"></i><b>1.15</b> Exporting data</a><ul>
<li class="chapter" data-level="1.15.1" data-path="getting-started.html"><a href="getting-started.html#readr"><i class="fa fa-check"></i><b>1.15.1</b> readr</a></li>
<li class="chapter" data-level="1.15.2" data-path="getting-started.html"><a href="getting-started.html#ggsave"><i class="fa fa-check"></i><b>1.15.2</b> ggsave</a></li>
<li class="chapter" data-level="1.15.3" data-path="getting-started.html"><a href="getting-started.html#exercise"><i class="fa fa-check"></i><b>1.15.3</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html"><i class="fa fa-check"></i><b>2</b> Data wrangling I</a><ul>
<li class="chapter" data-level="2.1" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#data-organisation-in-spreadsheets"><i class="fa fa-check"></i><b>2.1</b> Data organisation in spreadsheets</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#flat-formats-and-excel-files"><i class="fa fa-check"></i><b>2.1.1</b> Flat formats and Excel files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#portal-project"><i class="fa fa-check"></i><b>2.2</b> The Portal Project data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#downloading-and-importing-the-data"><i class="fa fa-check"></i><b>2.2.1</b> Downloading and importing the data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#dplyr"><i class="fa fa-check"></i><b>2.3</b> <code>dplyr</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>2.3.1</b> Filter rows with <code>filter()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#arrange-rows-with-arrange"><i class="fa fa-check"></i><b>2.3.2</b> Arrange rows with <code>arrange()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#select-columns-with-select"><i class="fa fa-check"></i><b>2.3.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#create-new-variables-with-mutate"><i class="fa fa-check"></i><b>2.3.4</b> Create new variables with <code>mutate()</code></a></li>
<li class="chapter" data-level="2.3.5" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#grouped-summaries-with-group_by-and-summarise"><i class="fa fa-check"></i><b>2.3.5</b> Grouped summaries with <code>group_by()</code> and <code>summarise()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#using-dpylr-to-explore-the-effect-of-kangaroo-rat-exclusion-on-granivore-populations"><i class="fa fa-check"></i><b>2.4</b> Using <code>dpylr</code> to explore the effect of Kangaroo Rat exclusion on Granivore populations</a><ul>
<li class="chapter" data-level="2.4.1" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#re-cap-of-filter-and-mutate"><i class="fa fa-check"></i><b>2.4.1</b> Re-cap of <code>filter()</code> and <code>mutate()</code></a></li>
<li class="chapter" data-level="2.4.2" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#use-lubridate-to-create-new-time-variables"><i class="fa fa-check"></i><b>2.4.2</b> Use <code>lubridate</code> to create new time variables</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#group-and-summarise-the-data-into-quarterly-observations"><i class="fa fa-check"></i><b>2.4.3</b> Group and summarise the data into quarterly observations</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-wrangle-1.html"><a href="data-wrangle-1.html#create-a-plot-with-ggplot"><i class="fa fa-check"></i><b>2.4.4</b> Create a plot with <code>ggplot</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html"><i class="fa fa-check"></i><b>3</b> Data wrangling II</a><ul>
<li class="chapter" data-level="3.1" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#reshaping-data-with-pivots"><i class="fa fa-check"></i><b>3.1</b> Reshaping data with pivots</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#tidyrpivot_longer"><i class="fa fa-check"></i><b>3.1.1</b> <code>tidyr::pivot_longer</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#tidyrpivot_wider"><i class="fa fa-check"></i><b>3.1.2</b> <code>tidyr::pivot_wider</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#missing-values"><i class="fa fa-check"></i><b>3.2</b> Missing values</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#find-na"><i class="fa fa-check"></i><b>3.2.1</b> Checking for explicit missing values using R</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#dropping-missing-values"><i class="fa fa-check"></i><b>3.2.2</b> Dropping missing values</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#completing-missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Completing missing values</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#joining-tables"><i class="fa fa-check"></i><b>3.3</b> Joining tables</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#keys"><i class="fa fa-check"></i><b>3.3.1</b> Keys</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#mutating-joins"><i class="fa fa-check"></i><b>3.3.2</b> Mutating joins</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#filtering-joins"><i class="fa fa-check"></i><b>3.3.3</b> Filtering joins</a></li>
<li class="chapter" data-level="3.3.4" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#set-operations"><i class="fa fa-check"></i><b>3.3.4</b> Set operations</a></li>
<li class="chapter" data-level="3.3.5" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#duplicate-keys"><i class="fa fa-check"></i><b>3.3.5</b> Duplicate keys</a></li>
<li class="chapter" data-level="3.3.6" data-path="data-wrangle-2.html"><a href="data-wrangle-2.html#binding-rows-and-columns"><i class="fa fa-check"></i><b>3.3.6</b> Binding rows and columns</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>4</b> Visualistion and communication</a><ul>
<li class="chapter" data-level="4.1" data-path="viz.html"><a href="viz.html#visualistion"><i class="fa fa-check"></i><b>4.1</b> Visualistion</a><ul>
<li class="chapter" data-level="4.1.1" data-path="viz.html"><a href="viz.html#exploratory-plots"><i class="fa fa-check"></i><b>4.1.1</b> Exploratory plots</a></li>
<li class="chapter" data-level="4.1.2" data-path="viz.html"><a href="viz.html#polished-plots"><i class="fa fa-check"></i><b>4.1.2</b> Polished plots</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="viz.html"><a href="viz.html#reports"><i class="fa fa-check"></i><b>4.2</b> Reports</a></li>
<li class="chapter" data-level="4.3" data-path="viz.html"><a href="viz.html#presentations"><i class="fa fa-check"></i><b>4.3</b> Presentations</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>5</b> Exploratory data analysis</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Coding togetheR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-wrangle-2" class="section level1">
<h1><span class="header-section-number">3</span> Data wrangling II</h1>
<p>Following on from chapter 2 this lesson deals with some
common tidying problems with data using the <a href="https://tidyr.tidyverse.org/"><code>tidyr</code> package</a> . By the end of this chapter the learner
will:</p>
<ul>
<li>have learnt how to transform rows and columns to reorganise data</li>
<li>have learnt some ways to deal with missing values</li>
<li>have learnt how to join data contained in separate tables into a single table</li>
</ul>
<div id="reshaping-data-with-pivots" class="section level2">
<h2><span class="header-section-number">3.1</span> Reshaping data with pivots</h2>
<p>As you will recall <a href="tidy-data">tidy data</a> means that in a table:</p>
<ol style="list-style-type: decimal">
<li>Every variable has its own column.</li>
<li>Every observation has its own row.</li>
<li>Each value has its own cell.</li>
</ol>
<p>Two common problems making your data untidy are that:</p>
<ol style="list-style-type: decimal">
<li>A single variable is spread across multiple colummns.</li>
<li>A single observation is distributed across multiple rows.</li>
</ol>
<p>In the first case the column names are actually the variable we are
interested in, making our table <strong>wide</strong>.</p>
<p>In the second case, the observation is contained in several rows instead
of a single row, making our table <strong>long</strong>.</p>
<p>Hence <code>tidyr</code> has functions that <strong>pivot</strong> (as in turning) a table from <strong>wide-to-long</strong> by reducing the number of columns and increasing the number of rows. Or from <strong>long-to-wide</strong> by reducing the number of rows and increasing the number of columns.</p>
<p>Usually, the hard part is identifying in a dataset our variables and our
observations, as it is not always obvious which is which.</p>
<div id="tidyrpivot_longer" class="section level3">
<h3><span class="header-section-number">3.1.1</span> <code>tidyr::pivot_longer</code></h3>
<p>First we’ll consider the case when our variable has been recorded as
column names by returning to a version of the <a href="portal-project">Portal surveys data</a>.</p>
<p>A table containing the mean weight of 10 rodent species on each plot from the rodent survey data
can be read directly into a <code>surveys_spread</code> object using the code below.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">surveys_spread &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ab604/ab604.github.io/master/docs/surveys_spread.csv&quot;</span>)</a></code></pre></div>
<p>Feel free to explore the data, and snapshot is shown in Figure <a href="data-wrangle-2.html#fig:pivot-long">3.1</a>.</p>
<p>Imagine that we recorded the mean weight of each rodent species on a plot in the field.
It makes sense to put the species as column headings, along with the plot id and
then record the values in each cell.</p>
<p>However, really our variables of interest are the rodent species and our observational
units, the rows, should contain the mean weight for a rodent species in a plot. Hence we
need to reduce the number of columns and create a longer table.</p>
<p>To do this we <code>pivot_longer()</code> by using <code>names_to = "genus"</code> to create a new <code>genus</code>
variable for the exisiting column heading, and <code>values_to = "mean_weight"</code> to create
a variable <code>mean_weight</code> for the values. We put a minus sign before the
variable <code>-plot_id</code> to tell the function not to use these values in the new variable column.</p>

<div class="figure" style="text-align: center"><span id="fig:pivot-long"></span>
<img src="img/pivot_longer_R.png" alt="tidyr::pivot_longer The genus of the rodents have been used as column headings for the weights of each animal. By creating new variables genus which takes the column names, and another variable mean_weight which takes the cell values, and but not the plot_id column we pivot from a wide table to a long table." width="100%" />
<p class="caption">
Figure 3.1: <code>tidyr::pivot_longer</code> The genus of the rodents have been used as column headings for the weights of each animal. By creating new variables <code>genus</code> which takes the column names, and another variable <code>mean_weight</code> which takes the cell values, and but not the <code>plot_id</code> column we pivot from a wide table to a long table.
</p>
</div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">surveys_spread <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="st">        </span><span class="kw">pivot_longer</span>(<span class="dt">names_to =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;mean_weight&quot;</span>, <span class="op">-</span>plot_id) </a></code></pre></div>
<pre><code>## # A tibble: 240 x 3
##    plot_id genus           mean_weight
##      &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;
##  1       1 Baiomys                7   
##  2       1 Chaetodipus           22.2 
##  3       1 Dipodomys             60.2 
##  4       1 Neotoma              156.  
##  5       1 Onychomys             27.7 
##  6       1 Perognathus            9.62
##  7       1 Peromyscus            22.2 
##  8       1 Reithrodontomys       11.4 
##  9       1 Sigmodon              NA   
## 10       1 Spermophilus          NA   
## # ... with 230 more rows</code></pre>
</div>
<div id="tidyrpivot_wider" class="section level3">
<h3><span class="header-section-number">3.1.2</span> <code>tidyr::pivot_wider</code></h3>
<p>If we wanted to go the other way, from wide to long, then we need to take values
from a single column to become variables names of multiple columns, populated
with values from an existing variable.</p>
<p>A version of the wide table in Figure <a href="data-wrangle-2.html#fig:pivot-wider">3.2</a> can be downloaded
into our environment and assigned as <code>surveys_gw</code> as before.</p>

<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">surveys_gw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ab604/ab604.github.io/master/docs/surveys_grouped_weight.csv&quot;</span>)</a></code></pre></div>
<p>This time we use <code>pivot_wider()</code> with the arguments <code>names_from</code> for the column
we want to use to create variables, and <code>values_from</code> for the column
whose values we want populate our new variable columns with.</p>
<div class="figure" style="text-align: center"><span id="fig:pivot-wider"></span>
<img src="img/pivot_wider_R.png" alt="tidyr::pivot_wider From long table surveys_gw the genus column contains the values that become variables using names_from and the mean_weight column contains the values that fill the new columns using values_from in the pivot from long to wide." width="100%" />
<p class="caption">
Figure 3.2: <code>tidyr::pivot_wider</code> From long table <code>surveys_gw</code> the <code>genus</code> column contains the values that become variables using <code>names_from</code> and the <code>mean_weight</code> column contains the values that fill the new columns using <code>values_from</code> in the pivot from long to wide.
</p>
</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">surveys_gw <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="st">        </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> genus, <span class="dt">values_from =</span> mean_weight) </a></code></pre></div>
<pre><code>## # A tibble: 24 x 11
##    plot_id Baiomys Chaetodipus Dipodomys Neotoma Onychomys Perognathus
##      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1       1    7           22.2      60.2    156.      27.7        9.62
##  2       2    6           25.1      55.7    169.      26.9        6.95
##  3       3    8.61        24.6      52.0    158.      26.0        7.51
##  4       5    7.75        18.0      51.1    190.      27.0        8.66
##  5      18    9.5         26.8      61.4    149.      26.6        8.62
##  6      19    9.53        26.4      43.3    120       23.8        8.09
##  7      20    6           25.1      65.9    155.      25.2        8.14
##  8      21    6.67        28.2      42.7    138.      24.6        9.19
##  9       4   NA           23.0      57.5    164.      28.1        7.82
## 10       6   NA           24.9      58.6    180.      25.9        7.81
## # ... with 14 more rows, and 4 more variables: Peromyscus &lt;dbl&gt;,
## #   Reithrodontomys &lt;dbl&gt;, Sigmodon &lt;dbl&gt;, Spermophilus &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">3.2</span> Missing values</h2>
<p>In R missing values are represented as <code>NA</code> (or <code>NaN</code> for an undefined mathematical
operation such as dividing by zero).</p>
<p>As discussed in <a href="https://r4ds.had.co.nz/tidy-data.html#missing-values-3">R4DS</a> values can be missing in two ways:</p>
<ul>
<li><strong>Explicitly</strong>, i.e. flagged with NA.</li>
<li><strong>Implicitly</strong>, i.e. simply not present in the data.</li>
</ul>
<p>If we had a subset of the surveys data that looked like this table:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="co"># Create a table with missing values</span></a>
<a class="sourceLine" id="cb69-2" title="2">surveys_ms &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">year =</span> <span class="kw">c</span>(<span class="dv">1991</span>,<span class="dv">1991</span>,<span class="dv">1991</span>,<span class="dv">1991</span>,<span class="dv">1992</span>,<span class="dv">1992</span>,<span class="dv">1992</span>),</a>
<a class="sourceLine" id="cb69-3" title="3">                     <span class="dt">qtr =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb69-4" title="4">                     <span class="dt">mean_weight =</span> <span class="kw">c</span>(<span class="fl">3.75</span>,<span class="fl">2.50</span>,<span class="ot">NA</span>,<span class="fl">8.50</span>,<span class="fl">7.50</span>,<span class="fl">2.25</span>,<span class="fl">2.50</span>))</a>
<a class="sourceLine" id="cb69-5" title="5"></a>
<a class="sourceLine" id="cb69-6" title="6">surveys_ms</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    year   qtr mean_weight
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1991     1        3.75
## 2  1991     2        2.5 
## 3  1991     3       NA   
## 4  1991     4        8.5 
## 5  1992     1        7.5 
## 6  1992     2        2.25
## 7  1992     4        2.5</code></pre>
<p>Then we can see that in the third quarter of 1991, no data was recorded by the
explicit <code>NA</code> value. However the third quarter of 1992 is missing altogether,
hence it is <em>implicitly</em> missing.</p>
<p>Another issue is that explicit missing values
are often recorded in real data in various ways e.g. an empty cell or as a dash.
We can’t cover all cases, but the general advice is to do some manual inspection
of your data in addition to using R to understand how missing values have been
recorded if there are any. In an ideal world data comes with a “code book” that
explains the data, but this often doesn’t happen.
Functions such as <code>read_csv()</code> allow you to
supply a vector of values representing <code>NA</code> which will convert these values in
your input to <code>NA</code>s.</p>
<p>Once you have identified missing values, in general there two ways to deal with them:</p>
<ol style="list-style-type: decimal">
<li>Drop incomplete observations</li>
<li>Complete the missing observations: fill or impute values.</li>
</ol>
<p>See also <a href="https://tidyr.tidyverse.org/reference/index.html#section-missing-values"><code>tidyr</code> functions for missing values</a>.</p>
<div id="find-na" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Checking for explicit missing values using R</h3>
<p>In addition to manual inspection, one way to check for explicit missing
values coded as <code>NA</code> in your data frame is to use the <code>is.na()</code> function which
returns a logical <code>TRUE</code> or <code>FALSE</code> vector of values.</p>
<p>Using this to check a single variable could be done by combining it with <code>select()</code>
for example using <code>surveys_ms</code>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">surveys_ms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-2" title="2"><span class="st">        </span><span class="kw">select</span>(mean_weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-3" title="3"><span class="st">        </span><span class="kw">is.na</span>()</a></code></pre></div>
<pre><code>##      mean_weight
## [1,]       FALSE
## [2,]       FALSE
## [3,]        TRUE
## [4,]       FALSE
## [5,]       FALSE
## [6,]       FALSE
## [7,]       FALSE</code></pre>
<p>Or with <code>filter()</code> to return the row where there is a missing value
for <code>mean_weight</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">surveys_ms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb73-2" title="2"><span class="st">        </span><span class="kw">filter</span>(<span class="kw">is.na</span>(mean_weight) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    year   qtr mean_weight
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1991     3          NA</code></pre>
<p>A more complicated use would be to combine <code>is.na()</code> with another function such
<code>sum()</code> to provide the total number of missing values for a variable, or to
combine <code>sum()</code> with <code>complete.cases()</code> to check each row for for missing values.</p>
<p>For example, to find the number of observations (rows) in <code>surveys</code> with no missing values:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">sum</span>(<span class="kw">complete.cases</span>(surveys))</a></code></pre></div>
<pre><code>## [1] 30676</code></pre>
<p>And for a single variable, we could extend our use of <code>select</code>:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">surveys_ms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-2" title="2"><span class="st">        </span><span class="kw">select</span>(mean_weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="st">        </span><span class="kw">is.na</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-4" title="4"><span class="st">        </span><span class="kw">sum</span>()</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Extending this find the missing values per variable in a whole data frame
requires introducing more syntax and the use of a map function from the <code>purr</code>
package. (Base R can also do this, but we’re staying in the tidyverse where possible).</p>
<p>The idea here is that we want to do the same calculation <em>mapped</em> across each
variable. The calculation here being count the number of missing values in each
column.</p>
<p>We pipe <code>surveys</code> to the <code>map_dfr()</code> function where <code>dfr</code> means return a data frame.
The <code>~</code> means we are applying a formula to the <code>surveys</code> input, which in this case
the formula is going to be <code>sum(is.na(.))</code> where <code>.</code> is the argument for the input
variable. The map function then does this for each variable in the <code>surveys</code> dataframe
and returns the output as a data frame. I’ve piped the output to <code>glimpse()</code> for
readability.</p>
<p>In words what this syntax is saying is <strong>“take the surveys dataframe and for
each column check if each value is <code>NA</code>, then sum the number of <code>NA</code>s in each
column and return the totals for all the columns as a dataframe.”</strong></p>
<p>This is pretty complicated if you’ve never seen this before, but hopefully you
can follow the idea.</p>
<p>This could be combined with <code>filter()</code> or <code>select()</code> prior to the map function
if you wanted to subset the data further for example.</p>
<p>See <a href="https://r4ds.had.co.nz/iteration.html#the-map-functions">R4DS map functions</a>
for more details.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">surveys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-2" title="2"><span class="st">        </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-3" title="3"><span class="st">        </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 1
## Variables: 13
## $ record_id       &lt;int&gt; 0
## $ month           &lt;int&gt; 0
## $ day             &lt;int&gt; 0
## $ year            &lt;int&gt; 0
## $ plot_id         &lt;int&gt; 0
## $ species_id      &lt;int&gt; 0
## $ sex             &lt;int&gt; 1748
## $ hindfoot_length &lt;int&gt; 3348
## $ weight          &lt;int&gt; 2503
## $ genus           &lt;int&gt; 0
## $ species         &lt;int&gt; 0
## $ taxa            &lt;int&gt; 0
## $ plot_type       &lt;int&gt; 0</code></pre>
<p>As we might expect the missing values are all for variables that record measurements
for the rodents.</p>
</div>
<div id="dropping-missing-values" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Dropping missing values</h3>
<p>The simplest solution to observations with missing values is to drop those
from the data set. If it makes sense to do this, then <code>tidyr::drop_na()</code> makes
it easy to do this. <strong>Note:</strong> This will create implicit missing values.</p>
<p>In Section <a href="data-wrangle-2.html#find-na">3.2.1</a> we found 30,676 rows with no missing values
by using <code>complete.cases()</code> on the <code>surveys</code> data of 34,786 observations.</p>
<p>Therefore we expect passing <code>surveys</code> to <code>drop_na()</code> will return a dataframe
of 30,676 observations:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">surveys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-2" title="2"><span class="st">        </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-3" title="3"><span class="st">        </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 30,676
## Variables: 13
## $ record_id       &lt;dbl&gt; 845, 1164, 1261, 1756, 1818, 1882, 2133, 2184,...
## $ month           &lt;dbl&gt; 5, 8, 9, 4, 5, 7, 10, 11, 1, 5, 5, 7, 10, 11, ...
## $ day             &lt;dbl&gt; 6, 5, 4, 29, 30, 4, 25, 17, 16, 18, 18, 8, 1, ...
## $ year            &lt;dbl&gt; 1978, 1978, 1978, 1979, 1979, 1979, 1979, 1979...
## $ plot_id         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2...
## $ species_id      &lt;chr&gt; &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;...
## $ sex             &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;...
## $ hindfoot_length &lt;dbl&gt; 32, 34, 32, 33, 32, 32, 33, 30, 33, 31, 33, 30...
## $ weight          &lt;dbl&gt; 204, 199, 197, 166, 184, 206, 274, 186, 184, 8...
## $ genus           &lt;chr&gt; &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;N...
## $ species         &lt;chr&gt; &quot;albigula&quot;, &quot;albigula&quot;, &quot;albigula&quot;, &quot;albigula&quot;...
## $ taxa            &lt;chr&gt; &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Roden...
## $ plot_type       &lt;chr&gt; &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;C...</code></pre>
<p><code>drop_na()</code> can accept variables arguments, meaning only the observations with
missing values in those columns will be dropped.</p>
<p>For example, here we drop only missing <code>weight</code> observations, so the rows which
have missing values for <code>hindfoot_length</code> or <code>sex</code> are kept.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">surveys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-2" title="2"><span class="st">        </span><span class="kw">drop_na</span>(weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-3" title="3"><span class="st">        </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 32,283
## Variables: 13
## $ record_id       &lt;dbl&gt; 588, 845, 990, 1164, 1261, 1453, 1756, 1818, 1...
## $ month           &lt;dbl&gt; 2, 5, 6, 8, 9, 11, 4, 5, 7, 10, 11, 1, 5, 5, 7...
## $ day             &lt;dbl&gt; 18, 6, 9, 5, 4, 5, 29, 30, 4, 25, 17, 16, 18, ...
## $ year            &lt;dbl&gt; 1978, 1978, 1978, 1978, 1978, 1978, 1979, 1979...
## $ plot_id         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2...
## $ species_id      &lt;chr&gt; &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;, &quot;NL&quot;...
## $ sex             &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;...
## $ hindfoot_length &lt;dbl&gt; NA, 32, NA, 34, 32, NA, 33, 32, 32, 33, 30, 33...
## $ weight          &lt;dbl&gt; 218, 204, 200, 199, 197, 218, 166, 184, 206, 2...
## $ genus           &lt;chr&gt; &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;Neotoma&quot;, &quot;N...
## $ species         &lt;chr&gt; &quot;albigula&quot;, &quot;albigula&quot;, &quot;albigula&quot;, &quot;albigula&quot;...
## $ taxa            &lt;chr&gt; &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Roden...
## $ plot_type       &lt;chr&gt; &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;C...</code></pre>
</div>
<div id="completing-missing-values" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Completing missing values</h3>
<p>There are numerous ways to complete missing values, but what they generally
have in common is the approach of guessing the missing value based on existing information, otherwise known as <a href="https://en.wikipedia.org/wiki/Imputation_(statistics)">imputation</a>.
Here we’ll cover a couple of ways to do it with <code>dplyr</code> and <code>tidyr</code> functions.</p>
<p>First, let’s deal with implicit missing values using <code>tidyr::complete()</code>.</p>
<p>Imagine we have the table <code>surveys_ms</code> which is missing the value
for the <code>mean_weight</code> for the third quarter of 1991 and all observations
for the third quarter of 1992:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">surveys_ms</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    year   qtr mean_weight
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1991     1        3.75
## 2  1991     2        2.5 
## 3  1991     3       NA   
## 4  1991     4        8.5 
## 5  1992     1        7.5 
## 6  1992     2        2.25
## 7  1992     4        2.5</code></pre>
<p>To add the row for the third quarter of 1992 we use <code>complete()</code> with the
<code>year</code> and <code>qtr</code> variables as arguments. The function finds all the unique
combinations of <code>year</code> and <code>qtr</code> and then adds any that are missing to create
a complete set of observations for 1991 and 1992 with explicit missing values.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">surveys_ms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="st">        </span><span class="kw">complete</span>(year,qtr)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr mean_weight
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1991     1        3.75
## 2  1991     2        2.5 
## 3  1991     3       NA   
## 4  1991     4        8.5 
## 5  1992     1        7.5 
## 6  1992     2        2.25
## 7  1992     3       NA   
## 8  1992     4        2.5</code></pre>
<p>Next let’s consider a complete table <code>surveys_ic</code> with an explicit missing value for
the <code>species_id</code>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1">surveys_ic &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">species_id =</span> <span class="kw">c</span>(<span class="st">&quot;DM&quot;</span>,<span class="st">&quot;DM&quot;</span>,<span class="ot">NA</span>,<span class="st">&quot;DS&quot;</span>,<span class="st">&quot;DS&quot;</span>,<span class="st">&quot;DS&quot;</span>),</a>
<a class="sourceLine" id="cb89-2" title="2">                     <span class="dt">mean_weight =</span> <span class="kw">c</span>(<span class="fl">3.75</span>,<span class="fl">2.50</span>,<span class="fl">8.50</span>,<span class="fl">7.50</span>,<span class="fl">5.50</span>,<span class="fl">2.50</span>))</a>
<a class="sourceLine" id="cb89-3" title="3">surveys_ic</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   species_id mean_weight
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 DM                3.75
## 2 DM                2.5 
## 3 &lt;NA&gt;              8.5 
## 4 DS                7.5 
## 5 DS                5.5 
## 6 DS                2.5</code></pre>
<p>In this case we might reasonably assume that the missing value is <code>DM</code> as we
have six observations on two species.</p>
<p>We can use <code>tidyr::fill()</code> to replace <code>NA</code> with the last non-missing value for
<code>species_id</code>. This is also known as last observation carried forward.</p>
<p>Passing <code>species_id</code> to <code>fill()</code> completes the table:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">surveys_ic <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-2" title="2"><span class="st">        </span><span class="kw">fill</span>(species_id)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   species_id mean_weight
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 DM                3.75
## 2 DM                2.5 
## 3 DM                8.5 
## 4 DS                7.5 
## 5 DS               NA   
## 6 DS                2.5</code></pre>
<p>Another common strategy is to impute missing values by using the mean or the
median of exisiting values for the same variable.</p>
<p>We can do that using <a href="https://dplyr.tidyverse.org/reference/coalesce.html"><code>dplyr::coalesce()</code></a> which is a function that finds the
first non-missing value in a variable and then replaces it using the second
argument.</p>
<p>For example, if we return to <code>surveys_ms</code> we used <code>complete()</code> to complete
the observations, but we have two <code>NA</code>s in the <code>mean_weight</code> column.</p>
<p>Let’s impute the missing values bt using the median value for <code>mean_weight</code> to
replace the <code>NA</code> values.</p>
<p>We can <code>mutate()</code> to overwrite the <code>mean_weight</code> variable (be careful when
you do this!) using <code>coalesce()</code> with <code>mean_weight</code> as the first argument to look
for missing values, and then the <code>median()</code> function is used to replace the missing
values with the median <code>mean_weight</code>, remembering to remove <code>NA</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1">surveys_ms <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-2" title="2"><span class="st">        </span><span class="kw">complete</span>(year,qtr) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">mean_weight =</span> <span class="kw">coalesce</span>(mean_weight, </a>
<a class="sourceLine" id="cb93-4" title="4">                                      <span class="kw">median</span>(mean_weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr mean_weight
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1  1991     1        3.75
## 2  1991     2        2.5 
## 3  1991     3        3.12
## 4  1991     4        8.5 
## 5  1992     1        7.5 
## 6  1992     2        2.25
## 7  1992     3        3.12
## 8  1992     4        2.5</code></pre>
<p>This gives us a complete table with . Whether it makes sense to do this is another
question, and you should think carefully about your missing value strategy as it
will influence your final output and conclusions.</p>
<p>Let’s repeat part of the analysis we did to find the <code>mean_weight</code>, and now
<code>mean_hindfoot</code>, for the full <code>surveys</code> dataset, but this time we’ll
complete the table by imputing values and compare the result to the result when
we drop the observations with missing values.</p>
<p>For simplicity, let’s just look at kangaroo rats. Here I introduce the <code>%in%</code>
operator with filter and vector containing the <code>species_id</code> for the kangaroo
rats.</p>
<p>This leaves 16,127 observations.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">krats &lt;-<span class="st"> </span>surveys <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb95-2" title="2"><span class="st">        </span><span class="kw">filter</span>(species_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DM&quot;</span>,<span class="st">&quot;DS&quot;</span>,<span class="st">&quot;DO&quot;</span>))</a>
<a class="sourceLine" id="cb95-3" title="3"></a>
<a class="sourceLine" id="cb95-4" title="4">krats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 16,127
## Variables: 13
## $ record_id       &lt;dbl&gt; 3, 226, 233, 245, 251, 257, 259, 268, 346, 350...
## $ month           &lt;dbl&gt; 7, 9, 9, 10, 10, 10, 10, 10, 11, 11, 11, 11, 1...
## $ day             &lt;dbl&gt; 16, 13, 13, 16, 16, 16, 16, 16, 12, 12, 12, 12...
## $ year            &lt;dbl&gt; 1977, 1977, 1977, 1977, 1977, 1977, 1977, 1977...
## $ plot_id         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2...
## $ species_id      &lt;chr&gt; &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;, &quot;DM&quot;...
## $ sex             &lt;chr&gt; &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;...
## $ hindfoot_length &lt;dbl&gt; 37, 37, 25, 37, 36, 37, 36, 36, 37, 37, 38, 36...
## $ weight          &lt;dbl&gt; NA, 51, 44, 39, 49, 47, 41, 55, 36, 47, 44, 40...
## $ genus           &lt;chr&gt; &quot;Dipodomys&quot;, &quot;Dipodomys&quot;, &quot;Dipodomys&quot;, &quot;Dipodo...
## $ species         &lt;chr&gt; &quot;merriami&quot;, &quot;merriami&quot;, &quot;merriami&quot;, &quot;merriami&quot;...
## $ taxa            &lt;chr&gt; &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Rodent&quot;, &quot;Roden...
## $ plot_type       &lt;chr&gt; &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;Control&quot;, &quot;C...</code></pre>
<p>How many missing values are there in <code>krats</code> and for which variables?</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="co"># How many missing values</span></a>
<a class="sourceLine" id="cb97-2" title="2">krats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 1
## Variables: 13
## $ record_id       &lt;int&gt; 0
## $ month           &lt;int&gt; 0
## $ day             &lt;int&gt; 0
## $ year            &lt;int&gt; 0
## $ plot_id         &lt;int&gt; 0
## $ species_id      &lt;int&gt; 0
## $ sex             &lt;int&gt; 131
## $ hindfoot_length &lt;int&gt; 1136
## $ weight          &lt;int&gt; 617
## $ genus           &lt;int&gt; 0
## $ species         &lt;int&gt; 0
## $ taxa            &lt;int&gt; 0
## $ plot_type       &lt;int&gt; 0</code></pre>
<p>Grouping by <code>species_id</code> and <code>sex</code>, find the <code>mean_weight</code> and <code>mean_hindfoot</code> when observations with missing values are dropped:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1">krats <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(species_id,sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-2" title="2"><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(weight), </a>
<a class="sourceLine" id="cb99-3" title="3">                  <span class="dt">mean_hindfoot =</span> <span class="kw">mean</span>(hindfoot_length))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   species_id [3]
##   species_id sex   mean_weight mean_hindfoot
##   &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
## 1 DM         F            41.6          35.7
## 2 DM         M            44.3          36.2
## 3 DO         F            48.5          35.5
## 4 DO         M            49.1          35.7
## 5 DS         F           117.           49.6
## 6 DS         M           123.           50.4</code></pre>
<p>Now we complete the table, first using <code>fill()</code> to impute the missing <code>sex</code> of
each kangaroo rat based on the last non-missing sex observation. Then we group
the kangaroo rats according to species and sex. Then we impute the missing <code>weight</code>
and <code>hindfoot_length</code> values with <code>mutate()</code> and <code>coalesce()</code> from each groups median
value. Finally we summarise again to find the <code>mean_weight</code> and <code>mean_hindfoot</code>
for each group.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1">krats <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-2" title="2"><span class="st">        </span><span class="kw">fill</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-3" title="3"><span class="st">        </span><span class="kw">group_by</span>(species_id,sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-4" title="4"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">weight =</span> <span class="kw">coalesce</span>(weight, <span class="kw">median</span>(weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb101-5" title="5">               <span class="dt">hindfoot_length =</span> <span class="kw">coalesce</span>(hindfoot_length, </a>
<a class="sourceLine" id="cb101-6" title="6">                                          <span class="kw">median</span>(hindfoot_length, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb101-7" title="7"><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">mean_weight =</span> <span class="kw">mean</span>(weight),</a>
<a class="sourceLine" id="cb101-8" title="8">                  <span class="dt">mean_hindfoot =</span> <span class="kw">mean</span>(hindfoot_length))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   species_id [3]
##   species_id sex   mean_weight mean_hindfoot
##   &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
## 1 DM         F            41.6          35.7
## 2 DM         M            44.4          36.2
## 3 DO         F            48.5          35.5
## 4 DO         M            49.2          35.7
## 5 DS         F           118.           49.6
## 6 DS         M           123.           50.3</code></pre>
<p>The results are very similar.</p>
</div>
</div>
<div id="joining-tables" class="section level2">
<h2><span class="header-section-number">3.3</span> Joining tables</h2>
<p>See also <a href="https://r4ds.had.co.nz/relational-data.html">R4DS Relational data chapter</a></p>
<p>Previously we’ve used data from the <a href="portal-project">Portal project</a> where
everything we needed was already contained within a single table, but often
we have <em>related</em> information spread across multiples tables that we want to analyse.
In these situations we need to join pairs of tables to explore relationships of interest.</p>
<p>We’ll use a dummy dataset here that recreates part of the data the Portal project
collects. As well as the animal census they separately record weather information.</p>
<p>Imagine we had two small tables, one called <code>airtemp</code> that contains the air temperature
in Celsius for three plots for one timepoint on one day. And another called <code>krat</code>
that records the observations for three plots on the same day for kangaroo rat
speciecs <code>DM</code>, <code>DS</code> and <code>RM</code>.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1">airtemp &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">date =</span> <span class="kw">date</span>(<span class="kw">c</span>(<span class="st">&#39;1990-01-07&#39;</span>,<span class="st">&#39;1990-01-07&#39;</span>,<span class="st">&#39;1990-01-07&#39;</span>)),</a>
<a class="sourceLine" id="cb103-2" title="2">               <span class="dt">plot =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb103-3" title="3">               <span class="dt">airtemp =</span> <span class="kw">c</span>(<span class="fl">7.3</span>,<span class="fl">9.5</span>,<span class="dv">11</span>))</a>
<a class="sourceLine" id="cb103-4" title="4"></a>
<a class="sourceLine" id="cb103-5" title="5">krat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">date =</span> <span class="kw">date</span>(<span class="kw">c</span>(<span class="st">&#39;1990-01-07&#39;</span>,<span class="st">&#39;1990-01-07&#39;</span>,<span class="st">&#39;1990-01-07&#39;</span>)),</a>
<a class="sourceLine" id="cb103-6" title="6">               <span class="dt">plot =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">6</span>),</a>
<a class="sourceLine" id="cb103-7" title="7">               <span class="dt">species =</span> <span class="kw">c</span>(<span class="st">&quot;DM&quot;</span>,<span class="st">&quot;DS&quot;</span>,<span class="st">&quot;RM&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 3
## Variables: 3
## $ date    &lt;date&gt; 1990-01-07, 1990-01-07, 1990-01-07
## $ plot    &lt;dbl&gt; 4, 8, 1
## $ airtemp &lt;dbl&gt; 7.3, 9.5, 11.0</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">krat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 3
## Variables: 3
## $ date    &lt;date&gt; 1990-01-07, 1990-01-07, 1990-01-07
## $ plot    &lt;dbl&gt; 4, 4, 6
## $ species &lt;chr&gt; &quot;DM&quot;, &quot;DS&quot;, &quot;RM&quot;</code></pre>
<p>We can think of three types of join, two of which correspond with <code>dplyr</code> verbs:</p>
<ol style="list-style-type: decimal">
<li>Joins that <strong>mutate</strong> the table. These are joins that create a new variable in one table using
observations from another.</li>
<li>Joins that <strong>filter</strong> the table. These are joins that keep only a subset of observations from
one table based on whether they match the observations in another.</li>
<li>Joins that perform <strong>set operations</strong>. These are joins corresponding with the
mathematical operation of intersection <span class="math inline">\(\cap\)</span>, union <span class="math inline">\(\cup\)</span>, and difference <span class="math inline">\(-\)</span>.</li>
</ol>
<blockquote>
<p><strong>Note</strong> Joins always use two tables. To add a third relationship it would
require joining the table created from the first join to another table. And so on.</p>
</blockquote>
<div id="keys" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Keys</h3>
<p>A key is a variable or set of variables that uniquely identifies an observation
in a table. In a simple case only one variable is sufficient, but often several variables
are required.</p>
<ul>
<li>Primary key: a key that uniquely identifies the observation in its own table
e.g. the combination of <code>date</code> and <code>plot</code> is unique to each set of observations in the <code>airtemp</code> table.</li>
<li>Foreign key: a key that uniquely identifies the observation in another table.
e.g. the combination of <code>date</code>, <code>plot</code> and <code>species</code> is unique to each set of observations in the <code>krat</code> table.</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(date,plot)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   date        plot     n
##   &lt;date&gt;     &lt;dbl&gt; &lt;int&gt;
## 1 1990-01-07     1     1
## 2 1990-01-07     4     1
## 3 1990-01-07     8     1</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">krat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(date,plot,species)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   date        plot species     n
##   &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;
## 1 1990-01-07     4 DM          1
## 2 1990-01-07     4 DS          1
## 3 1990-01-07     6 RM          1</code></pre>
<p>So joining <code>airtemp</code> and <code>krat</code> uses the <code>airtemp</code> primary key of <code>date</code> and <code>plot</code>.</p>
<p>Keys can be both primary and foreign, as they might be primary for one table and foreign in another or vice versa.</p>
<p>It’s a good idea to verify a key is primary i.e. uniquely identifies an observation.
See the examples in <a href="https://r4ds.had.co.nz/relational-data.html#keys">R4DS keys</a></p>
<p>If you discover your table lacks a primary key you can add one with <code>mutate()</code>.</p>
<p>Keys are called explicity using <code>by =</code> followed by the keys as a character vector.
For example, here we call <code>by = c("plot","date)</code>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(krat, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;plot&quot;</span>,<span class="st">&quot;date&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   date        plot airtemp species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 1990-01-07     4     7.3 DM     
## 2 1990-01-07     4     7.3 DS</code></pre>
<p>If we implicitly let the join function choose the keys, we get an output telling
us what was used.</p>
<p>If we had a key that had a different name in both tables, we tell the join
function that they are the same key by saying one variable is equal to another.
For example if we had <code>plot</code> in one table and it was called <code>plot_id</code> in another,
we could use <code>by = c("plot" = "plot_id")</code> to tell the join function that this is the key.</p>
</div>
<div id="mutating-joins" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Mutating joins</h3>
<p>These are joins that created new columns, hence they act like <code>dplyr::mutate</code>.</p>
<p>From <code>dplyr</code> we have:</p>
<ul>
<li><code>inner_join()</code> : keeps only the observations with matching keys in both tables</li>
<li><code>left_join()</code> : keeps all the observations in the left hand table</li>
<li><code>right_join()</code> : keeps all the observations in the right hand tables</li>
<li><code>full_join()</code> : keeps all the observations in both tables</li>
</ul>
<div id="inner-join" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> Inner join</h4>
<blockquote>
<p><code>inner_join()</code> : keeps only the observations with matching keys in both tables</p>
</blockquote>
<p>An inner join between <code>airtemp</code> and <code>krat</code> keeps only the observations which
have match in both tables using the primary key of <code>date</code> and <code>plot</code> as shown
in Figure <a href="data-wrangle-2.html#fig:inner-join-fig">3.3</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:inner-join-fig"></span>
<img src="img/inner_join.png" alt="Inner join" width="100%" />
<p class="caption">
Figure 3.3: Inner join
</p>
</div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 4
##   date        plot airtemp species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 1990-01-07     4     7.3 DM     
## 2 1990-01-07     4     7.3 DM</code></pre>
</div>
<div id="left-join" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> Left join</h4>
<blockquote>
<p><code>left_join()</code> : keeps all the observations in the left hand table</p>
</blockquote>
<p>An left join between <code>airtemp</code> and <code>krat</code> keeps all the observations in
<code>airtemp</code> and fills the missing observations in <code>species</code> with <code>NA</code> as shown
in Figure <a href="data-wrangle-2.html#fig:ljf">3.4</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:ljf"></span>
<img src="img/left_join.png" alt="Left join" width="100%" />
<p class="caption">
Figure 3.4: Left join
</p>
</div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 4 x 4
##   date        plot airtemp species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 1990-01-07     4     7.3 DM     
## 2 1990-01-07     4     7.3 DM     
## 3 1990-01-07     8     9.5 &lt;NA&gt;   
## 4 1990-01-07     1    11   &lt;NA&gt;</code></pre>
</div>
<div id="right-join" class="section level4">
<h4><span class="header-section-number">3.3.2.3</span> Right join</h4>
<blockquote>
<p><code>right_join()</code> : keeps all the observations in the right hand tables</p>
</blockquote>
<p>An right join between <code>airtemp</code> and <code>krat</code> keeps all the observations in
<code>krat</code> and fills the missing observations in <code>airtemp</code> with <code>NA</code> as shown in
Figure <a href="data-wrangle-2.html#fig:right-join-fig">3.5</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:right-join-fig"></span>
<img src="img/right_join.png" alt="Right join" width="100%" />
<p class="caption">
Figure 3.5: Right join
</p>
</div>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">right_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 3 x 4
##   date        plot airtemp species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 1990-01-07     4     7.3 DM     
## 2 1990-01-07     4     7.3 DM     
## 3 1990-01-07     6    NA   RM</code></pre>
</div>
<div id="full-join" class="section level4">
<h4><span class="header-section-number">3.3.2.4</span> Full join</h4>
<blockquote>
<p><code>full_join()</code> : keeps all the observations in both tables</p>
</blockquote>
<p>An full join between <code>airtemp</code> and <code>krat</code> keeps all the observations in
both tables and fills the missing observations in <code>airtemp</code> and <code>species</code> with <code>NA</code> as shown in
Figure <a href="data-wrangle-2.html#fig:full-join-fig">3.6</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:full-join-fig"></span>
<img src="img/full_join.png" alt="Full join" width="100%" />
<p class="caption">
Figure 3.6: Full join
</p>
</div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 5 x 4
##   date        plot airtemp species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 1990-01-07     4     7.3 DM     
## 2 1990-01-07     4     7.3 DM     
## 3 1990-01-07     8     9.5 &lt;NA&gt;   
## 4 1990-01-07     1    11   &lt;NA&gt;   
## 5 1990-01-07     6    NA   RM</code></pre>
</div>
</div>
<div id="filtering-joins" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Filtering joins</h3>
<p>Filtering joins act like the <code>filter</code> function keeping only observations
that match the join without adding or removing columns.</p>
<p><code>semi_join()</code> and <code>anti_join()</code></p>
<div id="semi-join" class="section level4">
<h4><span class="header-section-number">3.3.3.1</span> Semi join</h4>
<blockquote>
<p><code>semi_join()</code> keeps only the observations in the left hand table that
have a match in the right hand table.</p>
</blockquote>
<p>A semi-join between between <code>airtemp</code> and <code>krat</code> keeps only the observation
in <code>airtemp</code> that matches in <code>krat</code> as showin in Figure <a href="data-wrangle-2.html#fig:semi-join-fig">3.7</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:semi-join-fig"></span>
<img src="img/semi_join.png" alt="Semi join" width="100%" />
<p class="caption">
Figure 3.7: Semi join
</p>
</div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">semi_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 1 x 3
##   date        plot airtemp
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 1990-01-07     4     7.3</code></pre>
</div>
<div id="anti-join" class="section level4">
<h4><span class="header-section-number">3.3.3.2</span> Anti join</h4>
<blockquote>
<p><code>anti_join()</code> drops the observations in the left hand table that
have a match in the right hand table.</p>
</blockquote>
<p>A anti-join between between <code>airtemp</code> and <code>krat</code> drops the observations
in <code>airtemp</code> that match in <code>krat</code> as shown in
Figure <a href="data-wrangle-2.html#fig:anti-join-fig">3.8</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:anti-join-fig"></span>
<img src="img/anti_join.png" alt="Anti join" width="100%" />
<p class="caption">
Figure 3.8: Anti join
</p>
</div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">anti_join</span>(krat)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;date&quot;, &quot;plot&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   date        plot airtemp
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 1990-01-07     8     9.5
## 2 1990-01-07     1    11</code></pre>
</div>
</div>
<div id="set-operations" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Set operations</h3>
<p>These are joins corresponding with the
mathematical operation of intersection <span class="math inline">\(\cap\)</span>, union <span class="math inline">\(\cup\)</span>, and difference <span class="math inline">\(-\)</span>
as shown in Figure <a href="data-wrangle-2.html#fig:set-operations">3.9</a>. These are <code>intersect()</code>, <code>union()</code>
and <code>setdiff()</code>.</p>
<p>See <a href="https://r4ds.had.co.nz/relational-data.html#set-operations">R4DS set operations</a>
for examples of usage.</p>

<div class="figure" style="text-align: center"><span id="fig:set-operations"></span>
<img src="img/set-operations.png" alt="Set operations intersect(A,B), union(A,B) and setdiff(A,B)." width="50%" />
<p class="caption">
Figure 3.9: Set operations <code>intersect(A,B)</code>, <code>union(A,B)</code> and <code>setdiff(A,B)</code>.
</p>
</div>
</div>
<div id="duplicate-keys" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Duplicate keys</h3>
<p>If we have duplicate keys in each tables which aren’t used as part of the join, then
the join will create columns for both varaibles. For example, if we join <code>airtemp</code>
with <code>krat</code> only using <code>plot</code> as a key, but <code>date</code> is in both, we reuturn <code>date.x</code> and
<code>date.y</code> for <code>airtemp</code> and <code>krat</code> respecitively:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">airtemp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(krat, <span class="dt">by =</span> <span class="st">&quot;plot&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   date.x      plot airtemp date.y     species
##   &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;  
## 1 1990-01-07     4     7.3 1990-01-07 DM     
## 2 1990-01-07     4     7.3 1990-01-07 DS     
## 3 1990-01-07     8     9.5 NA         &lt;NA&gt;   
## 4 1990-01-07     1    11   NA         &lt;NA&gt;   
## 5 NA             6    NA   1990-01-07 RM</code></pre>
</div>
<div id="binding-rows-and-columns" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Binding rows and columns</h3>
<p>We can also join tables by binding rows or columns. Binding rows is useful when we have
tables with different sets of observations for the same variables, such as
when we have multiple replicates of an experiment. Binding columns can be done
when we want to add a column from one table that corresponds with the observations in
another.</p>
<p>See <a href="https://dplyr.tidyverse.org/reference/bind.html"><code>dplyr bind</code></a> :</p>
<p><em>“When row-binding, columns are matched by name, and any missing columns will be filled with NA.”</em></p>
<p><em>When column-binding, rows are matched by position, so all data frames must have the same number of rows."</em></p>
<p>These functions are <code>bind_rows</code> and <code>bind_cols</code>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-wrangle-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="viz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["coding-together.pdf"],
"toc": {
"collapse": "section"
},
"css": "style.css"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
