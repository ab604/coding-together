# Visualistion and communication {#viz}

Just as there are many types of data e.g. tables and
audio files, correspondingly there are many types of data visualisation e.g.
statistical plots and maps. Likewise visualisations we do for an exploration may
be different to those we do for communication. Therefore we narrow the scope here
to introduce some fundamentals of visualisation, presentations and reports.

By the end of this chapter you will be able to:

> + Use the `ggplot2` package to create exploratory plots and customize their plots
> + Use geometrical objects and aesthetic mappings to create box plots, bar plots and
time series plots
> + Use facets to split plots into subplots according to variables
> + Transform plots using statistcal mappings and catergorical variables (factors).
> + Transform data positions and coordinates
> + Use `ggplot2` themes and the `scales` package to customize plots
> + Export figures for use in documents and presentations
> + Create reports and presentations directly from RStudio

These skills will enable to start creating visualisations as well as
reports and presentations using R, 
but importantly it is up to 
you to determine what sort of visualiation is 
appropriate for the task at hand and for you to use your critical judgement in 
assessing a visualisation, presentation or report.

## Visualistion

[Albert Cairo](http://www.thefunctionalart.com/) is a journalist and academic
specialising in data visualisation and has written and continues to write 
extensively on the subject.

[Graphical Perception: Theory, Experimentation, and Application to the Development of Graphical Methods by Cleveland and  McGill](https://www.jstor.org/stable/pdf/2288400.pdf?refreqid=excelsior%3Ab321aba183cce22a7f93335ca107eec6)

```{r}
viz_dat <- tibble(Country =LETTERS[seq( from = 5, to = 1 )],
                  Percent = c(0.22,0.25,0.34,0.29,0.32)) 
```

```{r echo=FALSE,eval=FALSE}

blank_theme <- theme_minimal() +
  theme(legend.position = "",
  axis.ticks = element_blank(),
              axis.text.x = element_blank(),
              axis.text.y = element_blank(),
              axis.title.x = element_blank(),
              axis.title.y = element_blank(),
              panel.grid.major = element_blank(), 
              panel.grid.minor = element_blank(),
  panel.border = element_blank(),
  panel.grid=element_blank(),
  plot.title=element_text(size=14, face="bold")
  )

viz_dat %>% ggplot(aes(Country,Percent)) +
        geom_bar(stat = "identity") + 
        coord_flip() +

viz_dat %>% ggplot(aes(Country,Percent)) +
        geom_segment(aes(x=Country, xend=Country, y=0, yend=Percent)) +
        geom_point() +
        coord_flip()

viz_dat %>% ggplot(aes(Country,Percent)) +
        geom_point() +
        coord_flip()

viz_dat %>% ggplot(aes(Country,c(2,3,2.2,1.8,2.1), size = Percent, label = Country)) +
        geom_point(colour = 'blue') +
        geom_text(hjust = 0, nudge_x = 0.2, size = 6) +
        blank_theme

viz_dat %>% ggplot(aes(area =Percent,label = Country)) +
        geom_treemap() + geom_treemap_text()

viz_dat %>% ggplot(aes(x ="", fill=Percent, y = Percent)) +
        geom_bar(stat = "identity", color = "white") + 
        ylim(0,1) +
        coord_polar(theta = "y") +
        theme_void()+
        facet_wrap(~ Country) +
        blank_theme
```


### Datasaurus dozen

But why visualise data in the first place?

Inspired by the [Anscombe's Quartet](https://en.wikipedia.org/wiki/Anscombe%27s_quartet) and [Albert Cairo's Datasaurus](http://www.thefunctionalart.com/2016/08/download-datasaurus-never-trust-summary.html), Justin Matejka and
George Fitzmaurice
created the [Datasaurus dozen](https://www.autodeskresearch.com/publications/samestats) to 
illustrate a problem with relying only on summary statistics to understand data.

```{r datasaurus-dl, cache=TRUE}
# Download the Datasaurus Dozen
datasaurus <- read_tsv("https://raw.githubusercontent.com/ab604/coding-together/master/exercises/DatasaurusDozen.tsv")
# Quick look
glimpse(datasaurus)
# How many datasets
datasaurus %>% distinct(dataset)
```

```{r datasaurus-summary, cache=TRUE}
datasaurus %>% group_by(dataset) %>% summarise(mean_x = mean(x),
                                               mean_y = mean(y),
                                               sd_x = sd(x),
                                               sd_y = sd(y))
```

Let's remind ourselves of the basic form for creating plots with the `ggplot2` package: 

```{r, eval=FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION(mapping = aes(<MAPPINGS>))>
```

> + We provide a data frame as an argument to the `ggplot` function
> + Aesthetics (the variables we wish to plot) are mapped to a geometric 
object such as points. 
> + If we were to plot several `geoms()` on the same plot wanted to map the same aesthetics to each `geom()` we can pass the aesthetics argument to `ggplot()` directly: `ggplot(data = <DATA>,mapping = aes(<MAPPINGS>))`.
> + We can also pipe data into `ggplot()` as we would for other functions.

Here we use the basic form to plot the `datasaurus` but with the addition of `facet_wrap()`
in which the first argument is `~` representing "formula" (a type of data structure) and the 
second argument is the variable we wish to create individual plots for. 
In words read this as *"facets depend upon the dataset"*:

```{r datasaurus-plot, cache=TRUE}
 ggplot(data = datasaurus) +
        geom_point(mapping = aes(x,y)) +
        facet_wrap(~ dataset)
```


### Exploratory plots

Using `facet_wrap(~ rodent_type)` gives us this plot:

```{r,by_quarter_plot,echo=TRUE,cache=TRUE}
ggplot(data = by_quarter,
       mapping = aes(x=quarter,y=mean_captures,colour=plot_type)) +
  geom_line() +
  geom_point() +
  facet_wrap(~ rodent_type)
```

#### Boxplots

There are many other types of plot we may wish to create when exploring data. 
The previous plot showed us changes with time, but we might want to look at
averages and spread or other statistical summaries of the data.

### Boxplots

Box-plots are a standard way to plot the distribution of a data set. Plotting 
the data this way means that we drop the dynamic information, the time dimension,
but gain a compact summarised view of the variability of the number of captures.

In the following code we use the `boxplot()` geom, and this time swap the mapping
such that colour maps to the rodent type, and plots are faceted according to the plot type.

```{r,by_quarter_box_1,purl=FALSE,echo=TRUE}
ggplot(data= by_quarter,
       mapping = aes(x = rodent_type, 
                     y = mean_captures, 
                     colour = rodent_type)) +
  geom_boxplot() +
  facet_wrap(~ plot_type)
```

### Position adjustments

Another common adjustment we might make to our plots is to adjust the position 
of the data.

Recall the `mpg` data set for cars and our plot showing the fuel efficiency
versus the size of the engine. Many of the points are actually over plotted 
such that we can't see them.

By adding a bit of random noise to the position each data point, called `jitter`
we can spread the points out and see them more clearly. This is seen in the 
second plot below, where the `postion = "jitter"` argument has been provided
to the `geom_point()` function.

It's a little counter intuitive to add noise to a plot, but when we're trying to
explore data for patterns it can be very useful.

```{r,mpg_jitter,purl=FALSE,echo=TRUE}
# Without jitter
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = class))
# With jitter
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = class),
             position = "jitter")
```

Let's add points to our box-plot and for the challenge try comparing the plot
to one where the points are jittered.

```{r,by_quarter_box_2,purl=FALSE,echo=TRUE}
# Boxplot without jitter
ggplot(data= by_quarter,
       mapping = aes(x = rodent_type, y = mean_captures, 
                     colour = rodent_type)) +
  geom_boxplot() +
  geom_point(position = "jitter", alpha = 0.5) +
  facet_wrap(~ plot_type)
```

### Statistical transformations

Next we'll plot bar charts. 

These simple plots actually reveal subtleties in 
plots. In the following code we take the `by_month_genus` subset and create
a bar chart of `genus`, filling the bars with colour according to `rodent_type`.

```{r,by_month_bar_1,purl=FALSE,echo=TRUE}
# Create a bar plot of species monthly average captures 
surveys_subset %>% 
        filter(rodent_type != "Other") %>% 
        group_by(year,month,species_id,rodent_type,plot_type) %>% 
        summarise(captures = n()/31) %>% 
        ggplot() +
        geom_bar(mapping = aes(x = fct_reorder(species_id,captures), 
                               y = captures, fill=rodent_type), 
                 stat = "identity") + 
        facet_grid(~ plot_type) +
        coord_flip()
```

## Themes and customisations

When we're exploring our data we generally don't mind if the labels and colours
etc... are a bit messy. But when we want to publish or communicate our findings
to others we want everything to be just so.

This is where the code can become quite complicated and it's hard to provide
a general case. However, the underlying template remains the same:

```{r ggplot-full-template,,eval=FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(
     mapping = aes(<MAPPINGS>),
     stat = <STAT>, 
     position = <POSITION>
  ) +
  <COORDINATE_FUNCTION> +
  <FACET_FUNCTION>
```

## Reports

Using R for report writing and presentations.

## Presentations

My personal go-to for slide design guidance is [Melinda Seckington](https://missgeeky.com/2017/08/04/the-art-of-slide-design/). She
has written a fantastic step-by-step guide to creating effective slides.

Condensing her advice down she suggests:

> + Focus on one point per slide
> + Don't distract
> + Make important information stand out using what we know about graphical perception
> + Be consistent

I created a short [example presentation about cleaning your teeth](https://docs.google.com/presentation/d/e/2PACX-1vTa8VfB_jpB6fG4i157eNJb8sAyyKjJW06iZ8NNL1LPcB40w4NLLpK3TetbCuWSckX3wc8XuqdOpfnf/pub?start=false&loop=false&delayms=30000)
following these ideas.
